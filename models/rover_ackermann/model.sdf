<?xml version="1.0" ?>
<sdf version="1.6">
    <model name='rover_differential'>

        <!--base_link-->
        <link name='base_link'>
            <pose relative_to='__model__'>0 0 0.1 0 0 0</pose>
            <inertial>
                <mass>20.0</mass>
				<inertia>
					<ixx>0.37083</ixx>
					<ixy>0.0</ixy>
					<ixz>0.0</ixz>
					<iyy>0.37083</iyy>
					<iyz>0.0</iyz>
					<izz>0.53333</izz>
				</inertia>
            </inertial>
            <visual name='visual'>
                <geometry>
                    <box>
                        <size>0.5 0.25 0.1</size>
                    </box>
                </geometry>
                <material>
                    <ambient>0.0 0.0 1.0 1</ambient>
                    <diffuse>0.0 0.0 1.0 1</diffuse>
                    <specular>0.0 0.0 1.0 1</specular>
                </material>
            </visual>
            <collision name='collision'>
                <geometry>
                    <box>
                        <size>0.5 0.25 0.1</size>
                    </box>
                </geometry>
            </collision>
            <!--Sensors-->
            <sensor name="imu_sensor" type="imu">
				<always_on>1</always_on>
				<update_rate>250</update_rate>
				<imu>
					<angular_velocity>
						<x>
						<noise type="gaussian">
							<mean>0</mean>
							<stddev>0.0003394</stddev>
							<dynamic_bias_stddev>3.8785e-05</dynamic_bias_stddev>
							<dynamic_bias_correlation_time>1000</dynamic_bias_correlation_time>
						</noise>
						</x>
						<y>
						<noise type="gaussian">
							<mean>0</mean>
							<stddev>0.0003394</stddev>
							<dynamic_bias_stddev>3.8785e-05</dynamic_bias_stddev>
							<dynamic_bias_correlation_time>1000</dynamic_bias_correlation_time>
						</noise>
						</y>
						<z>
						<noise type="gaussian">
							<mean>0</mean>
							<stddev>0.0003394</stddev>
							<dynamic_bias_stddev>3.8785e-05</dynamic_bias_stddev>
							<dynamic_bias_correlation_time>1000</dynamic_bias_correlation_time>
						</noise>
						</z>
					</angular_velocity>
					<linear_acceleration>
						<x>
						<noise type="gaussian">
							<mean>0</mean>
							<stddev>0.004</stddev>
							<dynamic_bias_stddev>0.006</dynamic_bias_stddev>
							<dynamic_bias_correlation_time>300</dynamic_bias_correlation_time>
						</noise>
						</x>
						<y>
						<noise type="gaussian">
							<mean>0</mean>
							<stddev>0.004</stddev>
							<dynamic_bias_stddev>0.006</dynamic_bias_stddev>
							<dynamic_bias_correlation_time>300</dynamic_bias_correlation_time>
						</noise>
						</y>
						<z>
						<noise type="gaussian">
							<mean>0</mean>
							<stddev>0.004</stddev>
							<dynamic_bias_stddev>0.006</dynamic_bias_stddev>
							<dynamic_bias_correlation_time>300</dynamic_bias_correlation_time>
						</noise>
						</z>
					</linear_acceleration>
				</imu>
			</sensor>
            <sensor name="magnetometer_sensor" type="magnetometer">
				<always_on>1</always_on>
				<update_rate>100</update_rate>
				<magnetometer>
					<x>
						<noise type="gaussian">
						<stddev>0.0001</stddev>
						</noise>
					</x>
					<y>
						<noise type="gaussian">
						<stddev>0.0001</stddev>
						</noise>
					</y>
					<z>
						<noise type="gaussian">
						<stddev>0.0001</stddev>
						</noise>
					</z>
				</magnetometer>
			</sensor>
			<sensor name="navsat_sensor" type="navsat">
				<always_on>1</always_on>
				<update_rate>30</update_rate>
			</sensor>
            <sensor name="air_pressure_sensor" type="air_pressure">
				<always_on>1</always_on>
				<update_rate>50</update_rate>
				<air_pressure>
					<pressure>
						<noise type="gaussian">
							<mean>0</mean>
							<stddev>0.01</stddev>
						</noise>
					</pressure>
				</air_pressure>
			</sensor>
        </link>

        <!--Rear Wheel Left-->
        <link name='rear_wheel_left'>
            <pose relative_to="base_link">-0.15 0.15 -0.025 -1.5707 0 0</pose>
            <inertial>
                <mass>0.414</mass>
				<inertia>
					<ixx>0.00068682</ixx>
					<ixy>0</ixy>
					<ixz>0</ixz>
					<iyy>0.00068682</iyy>
					<iyz>0</iyz>
					<izz>0.00097299</izz>
				</inertia>
            </inertial>
            <visual name='visual'>
                <geometry>
                    <cylinder>
                        <radius>0.075</radius>
                        <length>0.05</length>
                    </cylinder>
                </geometry>
                <material>
                    <ambient>1.0 0.0 0.0 1</ambient>
                    <diffuse>1.0 0.0 0.0 1</diffuse>
                    <specular>1.0 0.0 0.0 1</specular>
                </material>
            </visual>
            <collision name='collision'>
                <geometry>
                    <cylinder>
                        <radius>0.075</radius>
                        <length>0.05</length>
                    </cylinder>
                </geometry>
                <surface>
					<friction>
                        <ode>
                            <mu>1.0</mu>
                            <mu2>1.0</mu2>
                            <fdir1>1 0 0</fdir1>
                        </ode>
					</friction>
				</surface>
            </collision>
        </link>

        <!--Rear Wheel Right-->
        <link name='rear_wheel_right'>
            <pose relative_to="base_link">-0.15 -0.15 -0.025 -1.5707 0 0</pose>
            <inertial>
                <mass>0.414</mass>
				<inertia>
					<ixx>0.00068682</ixx>
					<ixy>0</ixy>
					<ixz>0</ixz>
					<iyy>0.00068682</iyy>
					<iyz>0</iyz>
					<izz>0.00097299</izz>
				</inertia>
            </inertial>
            <visual name='visual'>
                <geometry>
                    <cylinder>
                        <radius>0.075</radius>
                        <length>0.05</length>
                    </cylinder>
                </geometry>
                <material>
                    <ambient>1.0 0.0 0.0 1</ambient>
                    <diffuse>1.0 0.0 0.0 1</diffuse>
                    <specular>1.0 0.0 0.0 1</specular>
                </material>
            </visual>
            <collision name='collision'>
                <geometry>
                    <cylinder>
                        <radius>0.075</radius>
                        <length>0.05</length>
                    </cylinder>
                </geometry>
                <surface>
					<friction>
                        <ode>
                            <mu>1.0</mu>
                            <mu2>1.0</mu2>
                            <fdir1>1 0 0</fdir1>
                        </ode>
					</friction>
				</surface>
            </collision>
        </link>

         <!--Front Wheel Left-->
        <link name='front_wheel_left'>
            <pose relative_to="base_link">0.15 0.15 -0.025 -1.5707 0 0</pose>
            <inertial>
                <mass>0.414</mass>
				<inertia>
					<ixx>0.00068682</ixx>
					<ixy>0</ixy>
					<ixz>0</ixz>
					<iyy>0.00068682</iyy>
					<iyz>0</iyz>
					<izz>0.00097299</izz>
				</inertia>
            </inertial>
            <visual name='visual'>
                <geometry>
                    <cylinder>
                        <radius>0.075</radius>
                        <length>0.05</length>
                    </cylinder>
                </geometry>
                <material>
                    <ambient>1.0 0.0 0.0 1</ambient>
                    <diffuse>1.0 0.0 0.0 1</diffuse>
                    <specular>1.0 0.0 0.0 1</specular>
                </material>
            </visual>
            <collision name='collision'>
                <geometry>
                    <cylinder>
                        <radius>0.075</radius>
                        <length>0.05</length>
                    </cylinder>
                </geometry>
                <surface>
					<friction>
                        <ode>
                            <mu>1.0</mu>
                            <mu2>1.0</mu2>
                            <fdir1>1 0 0</fdir1>
                        </ode>
					</friction>
				</surface>
            </collision>
        </link>

        <!--Front Wheel Right-->
        <link name='front_wheel_right'>
            <pose relative_to="base_link">0.15 -0.15 -0.025 -1.5707 0 0</pose>
            <inertial>
                <mass>0.414</mass>
				<inertia>
					<ixx>0.00068682</ixx>
					<ixy>0</ixy>
					<ixz>0</ixz>
					<iyy>0.00068682</iyy>
					<iyz>0</iyz>
					<izz>0.00097299</izz>
				</inertia>
            </inertial>
            <visual name='visual'>
                <geometry>
                    <cylinder>
                        <radius>0.075</radius>
                        <length>0.05</length>
                    </cylinder>
                </geometry>
                <material>
                    <ambient>1.0 0.0 0.0 1</ambient>
                    <diffuse>1.0 0.0 0.0 1</diffuse>
                    <specular>1.0 0.0 0.0 1</specular>
                </material>
            </visual>
            <collision name='collision'>
                <geometry>
                    <cylinder>
                        <radius>0.075</radius>
                        <length>0.05</length>
                    </cylinder>
                </geometry>
                <surface>
					<friction>
                        <ode>
                            <mu>1.0</mu>
                            <mu2>1.0</mu2>
                            <fdir1>1 0 0</fdir1>
                        </ode>
					</friction>
				</surface>
            </collision>
        </link>

        <link name="front_wheel_left_steering">
            <pose relative_to="front_wheel_left ">0 0 0 0 0 0</pose>
            <inertial>
                <mass>0.414</mass>
				<inertia>
					<ixx>0.00068682</ixx>
					<ixy>0</ixy>
					<ixz>0</ixz>
					<iyy>0.00068682</iyy>
					<iyz>0</iyz>
					<izz>0.00097299</izz>
				</inertia>
            </inertial>
	    </link>

        <link name="front_wheel_right_steering">
            <pose relative_to="front_wheel_right ">0 0 0 0 0 0</pose>
            <inertial>
                <mass>0.414</mass>
				<inertia>
					<ixx>0.00068682</ixx>
					<ixy>0</ixy>
					<ixz>0</ixz>
					<iyy>0.00068682</iyy>
					<iyz>0</iyz>
					<izz>0.00097299</izz>
				</inertia>
            </inertial>
	    </link>

        <!--left rear wheel joint-->
        <joint name='rear_wheel_left_joint' type='revolute'>
            <pose relative_to='rear_wheel_left'/>
            <parent>base_link</parent>
            <child>rear_wheel_left</child>
            <axis>
                <xyz expressed_in='__model__'>0 1 0</xyz>
                <limit>
                    <lower>-1.79769e+308</lower>
                    <upper>1.79769e+308</upper>
                </limit>
            </axis>
        </joint>

        <!--right rear wheel joint-->
        <joint name='rear_wheel_right_joint' type='revolute'>
            <pose relative_to='rear_wheel_right'/>
            <parent>base_link</parent>
            <child>rear_wheel_right</child>
            <axis>
                <xyz expressed_in='__model__'>0 1 0</xyz>
                <limit>
                    <lower>-1.79769e+308</lower>
                    <upper>1.79769e+308</upper>
                </limit>
            </axis>
        </joint>

        <!--Steering joints-->
        <joint name="front_wheel_right_steering_joint" type="revolute">
            <parent>base_link</parent>
            <child>front_wheel_right_steering</child>
            <axis>
                <xyz expressed_in='__model__'>0 0 1</xyz>
                <limit>
                    <lower>-0.5236</lower>
                    <upper>0.5236</upper>
                    <velocity>1.0</velocity>
                    <effort>25</effort>
                </limit>
            </axis>
	    </joint>

        <joint name="front_wheel_left_steering_joint " type="revolute">
            <parent>base_link</parent>
            <child>front_wheel_left_steering</child>
            <axis>
                <xyz expressed_in='__model__'>0 0 1</xyz>
                <limit>
                    <lower>-0.5236</lower>
                    <upper>0.5236</upper>
                    <velocity>1.0</velocity>
                    <effort>25</effort>
                </limit>
            </axis>
        </joint>

        <!--left front wheel joint-->
        <joint name='front_wheel_left_joint' type='revolute'>
            <pose relative_to='front_wheel_left'/>
            <parent>front_wheel_left_steering</parent>
            <child>front_wheel_left</child>
            <axis>
                <xyz expressed_in='__model__'>0 1 0</xyz>
                <limit>
                    <lower>-1.79769e+308</lower>
                    <upper>1.79769e+308</upper>
                </limit>
            </axis>
        </joint>

        <!--right front wheel joint-->
        <joint name='front_wheel_right_joint' type='revolute'>
            <pose relative_to='front_wheel_right'/>
            <parent>front_wheel_right_steering</parent>
            <child>front_wheel_right</child>
            <axis>
                <xyz expressed_in='__model__'>0 1 0</xyz>
                <limit>
                    <lower>-1.79769e+308</lower>
                    <upper>1.79769e+308</upper>
                </limit>
            </axis>
        </joint>

        <!--Plugins-->
        <plugin filename="gz-sim-joint-controller-system" name="gz::sim::systems::JointController">
            <joint_name>rear_wheel_left_joint</joint_name>
            <sub_topic>command/motor_speed</sub_topic>
            <use_actuator_msg>true</use_actuator_msg>
            <actuator_number>0</actuator_number>
            <p_gain>10.0</p_gain>
	    </plugin>

	    <plugin filename="gz-sim-joint-controller-system" name="gz::sim::systems::JointController">
	        <joint_name>rear_wheel_right_joint</joint_name>
	        <sub_topic>command/motor_speed</sub_topic>
		    <use_actuator_msg>true</use_actuator_msg>
	        <actuator_number>0</actuator_number>
	        <p_gain>10.0</p_gain>
	    </plugin>

        <plugin filename="gz-sim-joint-controller-system" name="gz::sim::systems::JointController">
	        <joint_name>front_wheel_left_joint</joint_name>
	        <sub_topic>command/motor_speed</sub_topic>
		    <use_actuator_msg>true</use_actuator_msg>
	        <actuator_number>0</actuator_number>
	        <p_gain>10.0</p_gain>
	    </plugin>

        <plugin filename="gz-sim-joint-controller-system" name="gz::sim::systems::JointController">
	        <joint_name>front_wheel_right_joint</joint_name>
	        <sub_topic>command/motor_speed</sub_topic>
		    <use_actuator_msg>true</use_actuator_msg>
	        <actuator_number>0</actuator_number>
	        <p_gain>10.0</p_gain>
	    </plugin>

        <plugin filename="gz-sim-joint-position-controller-system" name="gz::sim::systems::JointPositionController">
            <joint_name>front_wheel_right_steering_joint</joint_name>
            <sub_topic>servo_0</sub_topic>
            <p_gain>15</p_gain>
            <i_gain>1</i_gain>
            <d_gain>0</d_gain>
	    </plugin>

        <plugin filename="gz-sim-joint-position-controller-system" name="gz::sim::systems::JointPositionController">
            <joint_name>front_wheel_left_steering_joint</joint_name>
            <sub_topic>servo_0</sub_topic>
            <p_gain>15</p_gain>
            <i_gain>1</i_gain>
            <d_gain>0</d_gain>
        </plugin>

        <plugin filename="gz-sim-joint-state-publisher-system" name="gz::sim::systems::JointStatePublisher">
			<joint_name>rear_wheel_left_joint</joint_name>
			<joint_name>rear_wheel_right_joint</joint_name>
            <joint_name>front_wheel_left_joint</joint_name>
			<joint_name>front_wheel_right_joint</joint_name>
            <joint_name>front_wheel_right_steering_joint</joint_name>
			<joint_name>front_wheel_left_steering_joint</joint_name>
		</plugin>

        <plugin
            filename="libAckermannSteering.so"
            name="custom::AckermannSteering">
        </plugin>
    </model>
</sdf>
